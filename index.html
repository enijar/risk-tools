<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Risk Tools</title>
    <style>
      html {
        color-scheme: light dark;
      }
    </style>
  </head>
  <body></body>
  <script>
    const img = new Image();
    img.onload = extract;
    img.src = "./extracted/textureThumbnail_europeAdvanced.png";

    /**
     * @typedef Color
     * @type {[r: number, g: number, b: number, a: number]}
     *
     * @param {Color} color
     * @param {Color} min
     * @param {Color} max
     */
    function colorInRange(color, min, max) {
      return (
        color[0] >= min[0] &&
        color[0] <= max[0] &&
        color[1] >= min[1] &&
        color[1] <= max[1] &&
        color[2] >= min[2] &&
        color[2] <= max[2] &&
        color[3] >= min[3] &&
        color[3] <= max[3]
      );
    }

    function extract() {
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d", { willReadFrequently: true });
      document.body.appendChild(canvas);

      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);

      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;
      const black = [0, 0, 0, 255];
      const min = [196, 161, 114, 255];
      const max = [252, 240, 226, 255];

      for (let i = 0; i < data.length; i += 4) {
        const source = [data[i], data[i + 1], data[i + 2], data[i + 3]];
        if (colorInRange(source, min, max)) {
          data[i] = black[0];
          data[i + 1] = black[1];
          data[i + 2] = black[2];
          data[i + 3] = black[3];
        }
      }

      ctx.putImageData(imageData, 0, 0);

      canvas.addEventListener("pointerdown", (event) => {
        const x = event.offsetX;
        const y = event.offsetY;
        const { data } = ctx.getImageData(x, y, 1, 1);
        const color = [data[0], data[1], data[2], data[3]];
        console.log(color);
      });
    }
  </script>
</html>
